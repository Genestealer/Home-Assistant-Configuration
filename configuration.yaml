############################################################
#
# Home Assistant Main Configuration File
#
############################################################

homeassistant:
  # Name of the location where Home Assistant is running
  name: Home
  # Location required to calculate the time the sun rises and sets
  latitude: !secret latitude
  longitude: !secret longitude
  # Impacts weather/sunrise data
  elevation: !secret elevation
  unit_system: metric
  # Pick yours from here: http://en.wikipedia.org/wiki/List_of_tz_database_time_zones
  time_zone: Europe/London
  customize: !include includes\customise.yaml

    
# View all events in a logbook
logbook:
   exclude:
    entities:
      - binary_sensor.bunny_shed_heater
      - sensor.dark_sky_summary
      - sensor.dark_sky_hourly_summary
      - sensor.dark_sky_daily_summary


# Enables support for tracking state changes over time.
history:

# Show links to resources in log and frontend
#introduction:

# Checks for available updates
updater:

# Password
http:
  api_password: !secret http_password
  ssl_certificate: !secret SSL_cert 
  ssl_key: !secret SSL_key
  server_port: 443

  #   ssl_certificate: !secret SSL_cert
  # ssl_key: !secret SSL_key

recorder:
  purge_days: 24
  # exclude:
    

# Track the sun
sun:
  elevation: !secret elevation

# Allows you to issue voice commands from the frontend
conversation:

# enable configuration panel
config:

# Enables the frontend
frontend:  

# Discover some devices automatically
# discovery:


############################################################
#
# Components
#
############################################################


# APC UPS
apcupsd:
  host: localhost
  port: 3551

nest:
  client_id: !secret nest_id
  client_secret: !secret nest_secret

climate:
  platform: nest


# media_player:
#  # - platform: plex
#  - platform: cast

notify:
  - platform: pushover
    name: Pushover Notify
    api_key:  !secret pushover_api_key
    user_key:  !secret pushover_user_key

  - platform: html5
    name: Google Cloud Notify
    gcm_api_key: !secret gcmKey
    gcm_sender_id: !secret gcmID

  # - name: Facebook Notify
  #   platform: facebook
  #   page_access_token: !secret FB_Key    

device_tracker:
  platform: owntracks
  max_gps_accuracy: 250

mqtt:
  broker: localhost
  port: 1883
  client_id: home-assistant-1
  keepalive: 60
  username: !secret mqtt_username
  password: !secret mqtt_password 
    
tts:
  - platform: google

ifttt:
  key: !secret ifttt_key 



rflink:
  host: !secret RF_Link_IP
  port: !secret RF_Link_Port

############################################################
#
# Includes
#
############################################################

# Merge List
automation: !include_dir_merge_list includes\automation 
sensor: !include_dir_merge_list includes\sensors
light: !include_dir_merge_list includes\lights
binary_sensor: !include_dir_merge_list includes\binary_sensors\

#Merge named https://home-assistant.io/docs/configuration/splitting_configuration/
script: !include_dir_merge_named includes\scripts


# Single Files
zone: !include includes\zone.yaml
camera: !include includes\cameras.yaml




# Merge Named
group: !include_dir_merge_named includes\group



input_slider:
  minute_delay:
    name: Heat for x Mins
    initial: 60
    min: 1
    max: 120
    step: 1
    icon: mdi:clock-end  
  shed_target_temp:
    name: Bunny Shed Target Temperature Slider
    min: 1
    max: 15
    step: 1
    unit_of_measurement: step  
    icon: mdi:target



input_boolean:
  task_heat_towel_rail:
    name: Heat the towel rail for 1 hour
    initial: off
    icon: mdi:temperature-celsius
   
 

#automation:
#  alias: Heat Towel Rail
#  trigger:
#    platform: state
#    entity_id: input_boolean.task_heat_towel_rail
#    to: 'on'
#  condition:
#    platform: state
#    entity_id: input_boolean.task_heat_towel_rail
#    state: 'on'
#  action:
#    service: climate.set_temperature
#    data:
#      temperature: 26
#      entity_id: climate.hallway      


alexa:
  intents:
    LocateIntent:
      action:
        service: notify.notify
        data_template:
          message: "The location of {{ User }} has been queried via Alexa."
          data:
            title: "Home Assistant"
            sound: falling
            device: pixel
            url: !secret web_address
      speech:
        type: plaintext
        text: >
          {%- for state in states.device_tracker -%}
            {%- if state.name.lower() == User.lower() -%}
              {{ state.name }} is currently at {{ state.state }}
            {%- endif -%}
          {%- else -%}
            I am sorry, I do not know where {{ User }} is.
          {%- endfor -%}
      card:
        type: simple
        title: Sample title
        content: Some more content

  #       alexa:
  # intents:
  #   LocateIntent:
  #     action:
  #       service: notify.notify
  #       data_template:
  #         message: The location of {{ User }} has been queried via Alexa.
  #     speech:
  #       type: plaintext
  #       text: >
  #         {%- for state in states.device_tracker -%}
  #           {%- if state.name.lower() == User.lower() -%}
  #             {{ state.name }} is at {{ state.state }}
  #           {%- endif -%}
  #         {%- else -%}
  #           I am sorry, I do not know where {{ User }} is.
  #         {%- endfor -%}
  #     card:
  #       type: simple
  #       title: Sample title
  #       content: Some more content